<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è°ƒè¯•ç™»å½•</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .box { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .input-group { margin: 10px 0; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input, textarea { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 3px; box-sizing: border-box; }
    button { padding: 10px 20px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1976d2; }
    .result { background: #fff; padding: 10px; border: 1px solid #ddd; margin-top: 10px; white-space: pre-wrap; font-family: monospace; }
    .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
    .error { background: #ffebee; border-left: 4px solid #f44336; }
  </style>
</head>
<body>
  <h1>ğŸ” äº‘å‡½æ•°è°ƒç”¨è°ƒè¯•å·¥å…·</h1>

  <div class="box">
    <h3>ğŸ“ å¡«å†™ä¿¡æ¯</h3>
    <div class="input-group">
      <label>äº‘ç¯å¢ƒID:</label>
      <input type="text" id="envId" value="cloud1-7gir6egze217f975">
    </div>
    <div class="input-group">
      <label>äº‘å‡½æ•°åç§°:</label>
      <input type="text" id="functionName" value="adminLogin">
    </div>
    <div class="input-group">
      <label>è¯·æ±‚æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰:</label>
      <textarea id="requestData" rows="6">{"username": "admin", "password": "admin123"}</textarea>
    </div>
    <button onclick="testFunction()">ğŸ§ª æµ‹è¯•è°ƒç”¨</button>
  </div>

  <div id="results"></div>

  <script>
    function addResult(title, className, content) {
      const div = document.createElement('div');
      div.className = `box ${className}`;
      div.innerHTML = `<h3>${title}</h3><div class="result">${content}</div>`;
      document.getElementById('results').appendChild(div);
    }

    async function testFunction() {
      document.getElementById('results').innerHTML = '';

      const envId = document.getElementById('envId').value.trim();
      const functionName = document.getElementById('functionName').value.trim();
      const requestData = document.getElementById('requestData').value;

      // å°è¯•ä¸åŒçš„URLæ ¼å¼
      const urls = [
        {
          name: 'æ ¼å¼1: æ ‡å‡†HTTPæ ¼å¼ï¼ˆåŒç¯å¢ƒIDï¼‰',
          url: `https://${envId}.service.tcloudbase.com/${envId}/${functionName}`
        },
        {
          name: 'æ ¼å¼2: ç®€åŒ–æ ¼å¼ï¼ˆå•ç¯å¢ƒIDï¼‰',
          url: `https://${envId}.service.tcloudbase.com/${functionName}`
        }
      ];

      for (const item of urls) {
        addResult(item.name, 'loading', `URL: ${item.url}\næ­£åœ¨è¯·æ±‚...`);

        try {
          const response = await fetch(item.url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: requestData
          });

          const responseText = await response.text();

          if (response.ok) {
            addResult(`âœ… ${item.name}`, 'success',
              `çŠ¶æ€ç : ${response.status}\nå“åº”:\n${responseText}`);
          } else {
            addResult(`âš ï¸ ${item.name}`, 'loading',
              `çŠ¶æ€ç : ${response.status}\nå“åº”:\n${responseText}`);
          }
        } catch (error) {
          addResult(`âŒ ${item.name}`, 'error',
            `é”™è¯¯: ${error.message}\né”™è¯¯å †æ ˆ:\n${error.stack}`);
        }

        // ç­‰å¾…1ç§’
        await new Promise(resolve => setTimeout(resolve, 1000));
      }

      // æä¾›è°ƒè¯•å»ºè®®
      addResult('ğŸ’¡ è°ƒè¯•å»ºè®®', 'loading',
        `å¦‚æœæ‰€æœ‰æ ¼å¼éƒ½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ï¼š
1. äº‘ç¯å¢ƒIDæ˜¯å¦æ­£ç¡®ï¼š${envId}
2. äº‘å‡½æ•°æ˜¯å¦å·²éƒ¨ç½²åˆ°äº‘å¼€å‘ç¯å¢ƒ
3. äº‘å‡½æ•°åç§°æ˜¯å¦æ­£ç¡®ï¼š${functionName}
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
5. æ˜¯å¦éœ€è¦é…ç½®äº‘å‡½æ•°HTTPè®¿é—®æƒé™

æ­¥éª¤ï¼š
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. è¿›å…¥äº‘å¼€å‘æ§åˆ¶å°
3. ç‚¹å‡»"äº‘å‡½æ•°"
4. æ‰¾åˆ° ${functionName} äº‘å‡½æ•°
5. ç‚¹å‡»è¿›å…¥è¯¦æƒ…
6. æŸ¥çœ‹"HTTPè®¿é—®"é…ç½®`);
    }
  </script>
</body>
</html>
